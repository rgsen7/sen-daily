{{ define "main" }}
{{ $posts := where site.RegularPages "Section" "posts" }}
{{ $latest := first 1 $posts }}
{{ $recent := first 6 $posts }}
{{ $rest := after 1 $posts }}

{{/* ===== Top bar: title + stats ===== */}}
<div class="flex flex-col sm:flex-row sm:items-end sm:justify-between gap-2 mb-6">
  <div>
    <h1 class="text-xl font-semibold tracking-tight" style="color: var(--fg);">{{ .Site.Title }}</h1>
    <p class="text-xs font-mono mt-1" style="color: var(--fg-muted);">{{ .Site.Params.description }}</p>
  </div>
  <div class="flex items-center gap-4 text-xs font-mono" style="color: var(--fg-muted);">
    <span>å…± {{ len $posts }} æœŸ</span>
    <span>Â·</span>
    <span>{{ len .Site.Taxonomies.tags }} æ ‡ç­¾</span>
    <a href="{{ .Site.BaseURL }}index.xml" class="hover:opacity-70 transition-opacity" style="color: var(--primary);">ğŸ“¡ RSS</a>
  </div>
</div>

{{/* ===== Main grid: 2/3 content + 1/3 sidebar ===== */}}
<div class="grid grid-cols-1 lg:grid-cols-3 gap-4">

  {{/* ===== Left column (2/3): Latest issue ===== */}}
  <div class="lg:col-span-2 space-y-4">

    {{/* Latest issue â€” extract sections */}}
    {{ range $latest }}
    <a href="{{ .Permalink }}" class="card block p-5 group">
      <div class="flex items-center justify-between mb-3">
        <div class="flex items-center gap-2">
          <span class="text-xs font-mono font-medium px-2 py-0.5 rounded" style="background: var(--primary); color: var(--primary-fg);">æœ€æ–°</span>
          <time class="text-xs font-mono" style="color: var(--fg-muted);" datetime="{{ .Date.Format "2006-01-02" }}">{{ .Date.Format "2006-01-02" }}</time>
        </div>
      </div>
      <h2 class="text-base font-semibold group-hover:text-primary transition-colors leading-snug" style="color: var(--fg);">{{ .Title }}</h2>
      {{ with .Params.summary }}
      <p class="text-xs mt-2 leading-relaxed line-clamp-2" style="color: var(--fg-muted);">{{ . }}</p>
      {{ end }}
      {{ with .Params.tags }}
      <div class="flex flex-wrap gap-1 mt-3">
        {{ range first 6 . }}
        <span class="bg-tag text-xs font-mono px-1.5 py-0.5 rounded">{{ . }}</span>
        {{ end }}
      </div>
      {{ end }}
    </a>

    {{/* Extract bullet points from é€Ÿè§ˆ section for cards */}}
    {{ $content := .RawContent }}
    {{ $summary := .Params.summary }}
    {{ if $summary }}
    <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
      {{/* Speed-read cards â€” parse from summary or show tags as info cards */}}
      {{ with .Params.tags }}
      {{ range first 4 . }}
      <div class="card px-4 py-3">
        <span class="text-xs font-mono" style="color: var(--primary);">#{{ . }}</span>
      </div>
      {{ end }}
      {{ end }}
    </div>
    {{ end }}
    {{ end }}

    {{/* ===== Recent issues list ===== */}}
    <div class="card p-4">
      <h3 class="text-xs font-mono font-medium uppercase tracking-widest mb-3" style="color: var(--fg-muted);">å¾€æœŸæ—¥æŠ¥</h3>
      <div class="divide-y" style="border-color: var(--border);">
        {{ range $rest }}
        <a href="{{ .Permalink }}" class="flex items-center justify-between gap-3 py-2.5 group">
          <div class="min-w-0 flex-1">
            <span class="text-sm font-medium truncate block group-hover:text-primary transition-colors" style="color: var(--fg);">{{ .Title }}</span>
          </div>
          <time class="text-xs font-mono shrink-0" style="color: var(--fg-muted);" datetime="{{ .Date.Format "2006-01-02" }}">{{ .Date.Format "01-02" }}</time>
        </a>
        {{ end }}
      </div>
    </div>
  </div>

  {{/* ===== Right column (1/3): Sidebar ===== */}}
  <div class="space-y-4">

    {{/* Data dashboard card */}}
    <div class="card p-4">
      <h3 class="text-xs font-mono font-medium uppercase tracking-widest mb-3" style="color: var(--fg-muted);">æ•°æ®é€Ÿè§ˆ</h3>
      <div class="space-y-3">
        <div class="flex items-baseline justify-between">
          <span class="text-xs" style="color: var(--fg-muted);">æœ¬å‘¨ AI èèµ„</span>
          <span class="text-sm font-mono font-bold" style="color: var(--fg);">$173äº¿</span>
        </div>
        <div class="h-px" style="background: var(--border);"></div>
        <div class="flex items-baseline justify-between">
          <span class="text-xs" style="color: var(--fg-muted);">å…¨çƒ AI æ”¯å‡ºé¢„æµ‹</span>
          <span class="text-sm font-mono font-bold" style="color: var(--fg);">$2.52ä¸‡äº¿</span>
        </div>
        <div class="h-px" style="background: var(--border);"></div>
        <div class="flex items-baseline justify-between">
          <span class="text-xs" style="color: var(--fg-muted);">NVIDIA è¥æ”¶é¢„æœŸ</span>
          <span class="text-sm font-mono font-bold" style="color: var(--fg);">$655.8äº¿</span>
        </div>
      </div>
      <p class="text-xs font-mono mt-3 opacity-40">æ•°æ®æ¥æºï¼šæ—¥æŠ¥ Vol.042</p>
    </div>

    {{/* Tags cloud */}}
    <div class="card p-4">
      <h3 class="text-xs font-mono font-medium uppercase tracking-widest mb-3" style="color: var(--fg-muted);">çƒ­é—¨æ ‡ç­¾</h3>
      <div class="flex flex-wrap gap-1.5">
        {{ range .Site.Taxonomies.tags.ByCount }}
        {{ if le $.Ordinal 20 }}
        <a href="{{ .Page.Permalink }}" class="bg-tag text-xs font-mono px-2 py-0.5 rounded hover:opacity-80 transition-opacity">
          {{ .Page.Title }}<span class="opacity-50 ml-0.5">{{ .Count }}</span>
        </a>
        {{ end }}
        {{ end }}
      </div>
    </div>

    {{/* Quick nav */}}
    <div class="card p-4">
      <h3 class="text-xs font-mono font-medium uppercase tracking-widest mb-3" style="color: var(--fg-muted);">å¯¼èˆª</h3>
      <div class="space-y-2">
        <a href="{{ .Site.BaseURL }}archives/" class="flex items-center gap-2 text-sm hover:text-primary transition-colors" style="color: var(--fg);">
          <span class="text-xs font-mono" style="color: var(--fg-muted);">â†’</span> æ—¶é—´çº¿å½’æ¡£
        </a>
        <a href="{{ .Site.BaseURL }}tags/" class="flex items-center gap-2 text-sm hover:text-primary transition-colors" style="color: var(--fg);">
          <span class="text-xs font-mono" style="color: var(--fg-muted);">â†’</span> å…¨éƒ¨æ ‡ç­¾
        </a>
        <a href="{{ .Site.BaseURL }}index.xml" class="flex items-center gap-2 text-sm hover:text-primary transition-colors" style="color: var(--fg);">
          <span class="text-xs font-mono" style="color: var(--fg-muted);">â†’</span> RSS è®¢é˜…
        </a>
      </div>
    </div>

    {{/* About */}}
    <div class="card p-4">
      <h3 class="text-xs font-mono font-medium uppercase tracking-widest mb-3" style="color: var(--fg-muted);">å…³äº</h3>
      <p class="text-xs leading-relaxed" style="color: var(--fg-muted);">
        æ¯æ—¥è¿½è¸ª AI è¡Œä¸šåŠ¨æ€ï¼šèèµ„ã€äº§å“ã€æŠ€æœ¯çªç ´ã€æ”¿ç­–å˜åŒ–ã€‚ç”± Manus AI ç”Ÿæˆï¼Œæ£® ç¼–è¾‘å®¡æ ¸ã€‚
      </p>
    </div>
  </div>
</div>
{{ end }}
