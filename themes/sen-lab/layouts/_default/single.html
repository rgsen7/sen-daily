{{ define "main" }}
<article>
  <header class="mb-8">
    <h1 class="text-2xl font-extrabold leading-tight" style="color: var(--fg);">{{ .Title }}</h1>
    <div class="flex items-center gap-3 mt-3">
      <time class="text-sm font-mono" style="color: var(--fg-secondary);">{{ .Date.Format "2006-01-02" }}</time>
      {{ with .Params.categories }}{{ range . }}
      <span class="text-xs font-mono px-2 py-0.5 rounded" style="background: var(--code-bg); color: var(--fg-secondary);">{{ . }}</span>
      {{ end }}{{ end }}
    </div>
    {{ with .Params.tags }}
    <div class="flex flex-wrap gap-1.5 mt-3">
      {{ range . }}
      <a href="{{ "tags/" | absURL }}{{ . | urlize }}/" class="text-xs font-mono px-2 py-0.5 rounded hover:opacity-70 transition-opacity" style="background: var(--code-bg); color: var(--fg-secondary);">{{ . }}</a>
      {{ end }}
    </div>
    {{ end }}
  </header>

  {{/* TOC */}}
  {{ if .Params.showtoc | default .Site.Params.showtoc }}
  <details class="mb-8 p-4 rounded-lg" style="background: var(--entry); border: 1px solid var(--border);" open>
    <summary class="text-sm font-bold cursor-pointer" style="color: var(--fg);">目录</summary>
    <nav class="mt-3">
      {{ .TableOfContents }}
    </nav>
  </details>
  {{ end }}

  <div class="article-content">
    {{ .Content }}
  </div>

  {{/* Prev/Next */}}
  <nav class="mt-12 pt-6 grid grid-cols-1 sm:grid-cols-2 gap-3" style="border-top: 1px solid var(--border);">
    {{ with .PrevInSection }}
    <a href="{{ .Permalink }}" class="post-entry group">
      <span class="text-xs font-mono" style="color: var(--fg-secondary);">← 上一期</span>
      <p class="text-base font-bold mt-1 truncate group-hover:opacity-70 transition-opacity" style="color: var(--fg);">{{ .Title }}</p>
    </a>
    {{ else }}<div></div>{{ end }}
    {{ with .NextInSection }}
    <a href="{{ .Permalink }}" class="post-entry group text-right">
      <span class="text-xs font-mono" style="color: var(--fg-secondary);">下一期 →</span>
      <p class="text-base font-bold mt-1 truncate group-hover:opacity-70 transition-opacity" style="color: var(--fg);">{{ .Title }}</p>
    </a>
    {{ else }}<div></div>{{ end }}
  </nav>

  {{/* Giscus */}}
  {{ if .Site.Params.giscus.repo }}
  <div class="mt-12" id="comments">
    <script src="https://giscus.app/client.js"
      data-repo="{{ .Site.Params.giscus.repo }}"
      data-repo-id="{{ .Site.Params.giscus.repoId }}"
      data-category="{{ .Site.Params.giscus.category }}"
      data-category-id="{{ .Site.Params.giscus.categoryId }}"
      data-mapping="{{ .Site.Params.giscus.mapping }}"
      data-strict="{{ .Site.Params.giscus.strict }}"
      data-reactions-enabled="{{ .Site.Params.giscus.reactionsEnabled }}"
      data-emit-metadata="0"
      data-input-position="top"
      data-theme="dark"
      data-lang="zh-CN"
      data-loading="lazy"
      crossorigin="anonymous"
      async>
    </script>
  </div>
  {{ end }}
</article>
{{ end }}
