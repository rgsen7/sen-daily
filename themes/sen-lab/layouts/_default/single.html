{{ define "main" }}
<article class="max-w-6xl mx-auto">
  {{/* Header */}}
  <header class="mb-10 pb-6" style="border-bottom: 2px solid var(--primary);">
    <div class="flex items-center gap-3 mb-3">
      {{ with .Params.categories }}
      {{ range . }}
      <span class="text-xs font-mono font-bold px-2 py-1 rounded" style="background: var(--primary); color: var(--primary-fg);">{{ . }}</span>
      {{ end }}
      {{ end }}
      <time class="text-sm font-mono" style="color: var(--fg-muted);" datetime="{{ .Date.Format "2006-01-02" }}">{{ .Date.Format "2006-01-02" }}</time>
    </div>
    <h1 class="text-2xl font-extrabold tracking-tight leading-snug" style="color: var(--fg);">{{ .Title }}</h1>
    {{ with .Params.tags }}
    <div class="flex flex-wrap gap-2 mt-4">
      {{ range . }}
      <a href="{{ "tags/" | absURL }}{{ . | urlize }}/" class="bg-tag text-sm font-mono px-2 py-0.5 rounded hover:opacity-80 transition-opacity">{{ . }}</a>
      {{ end }}
    </div>
    {{ end }}
  </header>

  {{/* Two-column */}}
  <div class="grid grid-cols-1 lg:grid-cols-4 gap-10">

    {{/* Content 3/4 */}}
    <div class="lg:col-span-3">
      <div class="article-content" style="color: var(--fg-muted);">
        {{ .Content }}
      </div>
    </div>

    {{/* Sidebar TOC 1/4 */}}
    <aside class="hidden lg:block">
      <div class="sticky top-8 space-y-5">
        <div class="card p-5">
          <h3 class="section-label mb-3">目录</h3>
          <nav>
            {{ .TableOfContents }}
          </nav>
        </div>

        {{ with .Params.tags }}
        <div class="card p-5">
          <h3 class="section-label mb-3">本期标签</h3>
          <div class="flex flex-wrap gap-1.5">
            {{ range . }}
            <span class="bg-tag text-xs font-mono px-2 py-0.5 rounded">{{ . }}</span>
            {{ end }}
          </div>
        </div>
        {{ end }}
      </div>
    </aside>
  </div>

  {{/* Prev/Next */}}
  <nav class="mt-14 pt-6 grid grid-cols-1 sm:grid-cols-2 gap-4" style="border-top: 2px solid var(--border);">
    {{ with .PrevInSection }}
    <a href="{{ .Permalink }}" class="card px-5 py-4 group">
      <span class="section-label">← 上一期</span>
      <p class="text-base font-bold mt-1.5 truncate group-hover:text-primary transition-colors" style="color: var(--fg);">{{ .Title }}</p>
    </a>
    {{ else }}<div></div>{{ end }}

    {{ with .NextInSection }}
    <a href="{{ .Permalink }}" class="card px-5 py-4 group text-right">
      <span class="section-label">下一期 →</span>
      <p class="text-base font-bold mt-1.5 truncate group-hover:text-primary transition-colors" style="color: var(--fg);">{{ .Title }}</p>
    </a>
    {{ else }}<div></div>{{ end }}
  </nav>

  {{/* Giscus */}}
  {{ if .Site.Params.giscus.repo }}
  <div class="mt-14" id="comments">
    <script src="https://giscus.app/client.js"
      data-repo="{{ .Site.Params.giscus.repo }}"
      data-repo-id="{{ .Site.Params.giscus.repoId }}"
      data-category="{{ .Site.Params.giscus.category }}"
      data-category-id="{{ .Site.Params.giscus.categoryId }}"
      data-mapping="{{ .Site.Params.giscus.mapping }}"
      data-strict="{{ .Site.Params.giscus.strict }}"
      data-reactions-enabled="{{ .Site.Params.giscus.reactionsEnabled }}"
      data-emit-metadata="0"
      data-input-position="top"
      data-theme="dark"
      data-lang="zh-CN"
      data-loading="lazy"
      crossorigin="anonymous"
      async>
    </script>
  </div>
  {{ end }}
</article>
{{ end }}
