<!DOCTYPE html>
<html lang="{{ .Site.LanguageCode }}" class="dark">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>{{ if .IsHome }}{{ .Site.Title }}{{ else }}{{ .Title }} — {{ .Site.Title }}{{ end }}</title>
  <meta name="description" content="{{ with .Description }}{{ . }}{{ else }}{{ .Site.Params.description }}{{ end }}">
  
  {{/* OG */}}
  <meta property="og:title" content="{{ .Title }}">
  <meta property="og:description" content="{{ with .Description }}{{ . }}{{ else }}{{ .Site.Params.description }}{{ end }}">
  <meta property="og:type" content="{{ if .IsPage }}article{{ else }}website{{ end }}">
  <meta property="og:url" content="{{ .Permalink }}">
  {{ with .Site.Params.images }}<meta property="og:image" content="{{ index . 0 | absURL }}">{{ end }}

  {{/* Tailwind CSS via CDN */}}
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          fontFamily: {
            sans: ['Inter', 'system-ui', '-apple-system', 'sans-serif'],
            mono: ['JetBrains Mono', 'Fira Code', 'monospace']
          },
          maxWidth: {
            article: '780px'
          }
        }
      }
    }
  </script>

  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=JetBrains+Mono:wght@400;500;600&display=swap');

    /* === Light theme — lab/research institute feel === */
    :root {
      --bg: #f5f5f0;
      --fg: #1a1a1a;
      --fg-muted: #555550;
      --card: #ffffff;
      --card-fg: #1a1a1a;
      --muted: #eaeae5;
      --border: #d5d5cc;
      --primary: #2d6a4f;
      --primary-fg: #ffffff;
      --primary-light: #40916c;
      --tag-bg: #d8f3dc;
      --tag-fg: #1b4332;
      --accent: #b7e4c7;
      --stat-up: #2d6a4f;
      --stat-down: #c1121f;
      --radius: 0.375rem;
      --header-bg: #1a1a1a;
      --header-fg: #f5f5f0;
    }

    /* === Dark theme === */
    .dark {
      --bg: #0f0f0f;
      --fg: #ebebeb;
      --fg-muted: #8a8a80;
      --card: #1a1a18;
      --card-fg: #ebebeb;
      --muted: #252522;
      --border: rgba(255,255,255,0.08);
      --primary: #52b788;
      --primary-fg: #0f0f0f;
      --primary-light: #74c69d;
      --tag-bg: rgba(82,183,136,0.12);
      --tag-fg: #74c69d;
      --accent: #2d6a4f;
      --stat-up: #52b788;
      --stat-down: #ef6461;
      --header-bg: #0a0a0a;
      --header-fg: #ebebeb;
    }

    /* === Base === */
    html { background: var(--bg); color: var(--fg-muted); font-size: 16px; }
    ::selection { background: rgba(45,106,79,0.25); }
    
    ::-webkit-scrollbar { width: 6px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 3px; }

    /* === Utility === */
    .text-fg { color: var(--fg); }
    .text-fg-muted { color: var(--fg-muted); }
    .text-primary { color: var(--primary); }
    .bg-bg { background: var(--bg); }
    .bg-card { background: var(--card); }
    .bg-muted { background: var(--muted); }
    .border-theme { border-color: var(--border); }
    .bg-tag { background: var(--tag-bg); color: var(--tag-fg); }

    /* === Header — bold, dark bar === */
    .site-header {
      background: var(--header-bg);
      color: var(--header-fg);
    }

    /* === Article content — readable, generous sizing === */
    .article-content h2 {
      font-size: 1.35rem; font-weight: 700; margin-top: 2.5rem; margin-bottom: 1rem;
      color: var(--fg); padding-bottom: 0.5rem; border-bottom: 2px solid var(--primary);
    }
    .article-content h3 {
      font-size: 1.15rem; font-weight: 700; margin-top: 2rem; margin-bottom: 0.75rem;
      color: var(--fg); letter-spacing: -0.01em;
    }
    .article-content p { margin-bottom: 1rem; line-height: 1.8; font-size: 1rem; }
    .article-content ul { list-style: none; padding-left: 0; margin-bottom: 1rem; }
    .article-content li {
      margin-bottom: 0.5rem; line-height: 1.75; font-size: 1rem;
      padding-left: 1.25rem; position: relative;
    }
    .article-content li::before {
      content: ""; position: absolute; left: 0; top: 0.7em;
      width: 6px; height: 6px; border-radius: 50%;
      background: var(--primary);
    }
    .article-content a { color: var(--primary); text-decoration: none; font-weight: 500; border-bottom: 1px solid transparent; transition: border-color 0.15s; }
    .article-content a:hover { border-bottom-color: var(--primary); }
    .article-content strong { color: var(--fg); font-weight: 700; }
    .article-content hr { border: none; border-top: 2px solid var(--border); margin: 2rem 0; }
    .article-content blockquote {
      border-left: 3px solid var(--primary); padding: 0.75rem 1.25rem;
      color: var(--fg); margin: 1.25rem 0; background: var(--muted);
      border-radius: 0 var(--radius) var(--radius) 0; font-size: 0.95rem;
      font-style: italic;
    }
    .article-content code { font-family: 'JetBrains Mono', monospace; font-size: 0.875rem; background: var(--muted); padding: 0.15rem 0.4rem; border-radius: 3px; }
    .article-content pre { background: var(--card); border: 1px solid var(--border); border-radius: var(--radius); padding: 1rem; overflow-x: auto; margin: 1.25rem 0; font-size: 0.875rem; }
    .article-content pre code { background: none; padding: 0; }

    /* === TOC === */
    #TableOfContents { font-size: 0.8rem; }
    #TableOfContents ul { list-style: none; padding-left: 0; margin: 0; }
    #TableOfContents li { margin-bottom: 0.4rem; }
    #TableOfContents a { color: var(--fg-muted); text-decoration: none; transition: color 0.15s; display: block; padding: 0.2rem 0; }
    #TableOfContents a:hover { color: var(--primary); }
    #TableOfContents ul ul { padding-left: 0.75rem; margin-top: 0.25rem; }

    /* === Line clamp === */
    .line-clamp-2 { display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
    .line-clamp-3 { display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical; overflow: hidden; }

    /* === Card — with presence === */
    .card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      transition: border-color 0.2s ease, box-shadow 0.2s ease;
    }
    .card:hover {
      border-color: var(--primary);
      box-shadow: 0 0 0 1px var(--primary);
    }

    /* === Featured card === */
    .card-featured {
      border-left: 3px solid var(--primary);
    }

    /* === Section label — bold mono === */
    .section-label {
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.7rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      color: var(--fg-muted);
    }

    /* === Stat === */
    .stat-value { font-size: 1.75rem; font-weight: 800; font-family: 'JetBrains Mono', monospace; color: var(--fg); }
    .stat-label { font-size: 0.75rem; color: var(--fg-muted); text-transform: uppercase; letter-spacing: 0.05em; }
  </style>

  {{ partial "extend_head.html" . }}
  
  {{/* RSS */}}
  {{ range .AlternativeOutputFormats }}
  <link rel="{{ .Rel }}" type="{{ .MediaType.Type }}" href="{{ .Permalink | safeURL }}">
  {{ end }}
</head>
<body class="font-sans min-h-screen antialiased" style="background: var(--bg); color: var(--fg-muted);">
  
  {{ partial "header.html" . }}
  
  <main class="max-w-6xl mx-auto px-4 sm:px-6 py-8">
    {{ block "main" . }}{{ end }}
  </main>

  {{ partial "footer.html" . }}

  <script>
    const html = document.documentElement;
    const stored = localStorage.getItem('theme');
    if (stored === 'light') html.classList.remove('dark');
    else if (stored === 'dark' || !stored) html.classList.add('dark');
    
    function toggleTheme() {
      html.classList.toggle('dark');
      localStorage.setItem('theme', html.classList.contains('dark') ? 'dark' : 'light');
    }
  </script>
</body>
</html>
