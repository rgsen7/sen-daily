<!DOCTYPE html>
<html lang="{{ .Site.LanguageCode }}" class="dark">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>{{ if .IsHome }}{{ .Site.Title }}{{ else }}{{ .Title }} — {{ .Site.Title }}{{ end }}</title>
  <meta name="description" content="{{ with .Description }}{{ . }}{{ else }}{{ .Site.Params.description }}{{ end }}">
  
  {{/* OG */}}
  <meta property="og:title" content="{{ .Title }}">
  <meta property="og:description" content="{{ with .Description }}{{ . }}{{ else }}{{ .Site.Params.description }}{{ end }}">
  <meta property="og:type" content="{{ if .IsPage }}article{{ else }}website{{ end }}">
  <meta property="og:url" content="{{ .Permalink }}">
  {{ with .Site.Params.images }}<meta property="og:image" content="{{ index . 0 | absURL }}">{{ end }}

  {{/* Tailwind CSS via CDN */}}
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          fontFamily: {
            sans: ['Inter', 'system-ui', '-apple-system', 'sans-serif'],
            mono: ['JetBrains Mono', 'Fira Code', 'monospace']
          },
          maxWidth: {
            article: '720px'
          },
          borderRadius: {
            DEFAULT: '0.5rem'
          }
        }
      }
    }
  </script>

  {{/* Custom styles — oklch color system from shadcn/21st.dev */}}
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap');

    /* === Theme Variables — restrained sage green === */
    :root {
      --bg: oklch(0.985 0.002 155);
      --fg: oklch(0.16 0.01 155);
      --fg-muted: oklch(0.50 0.02 155);
      --card: oklch(0.995 0.001 155);
      --card-fg: oklch(0.16 0.01 155);
      --muted: oklch(0.96 0.008 155);
      --border: oklch(0.90 0.015 155);
      --primary: oklch(0.48 0.10 158);
      --primary-fg: oklch(0.99 0 0);
      --tag-bg: oklch(0.94 0.025 155);
      --tag-fg: oklch(0.38 0.06 158);
      --stat-up: oklch(0.55 0.14 155);
      --stat-down: oklch(0.60 0.14 25);
      --radius: 0.375rem;
    }
    .dark {
      --bg: oklch(0.115 0.005 155);
      --fg: oklch(0.92 0.01 155);
      --fg-muted: oklch(0.52 0.02 155);
      --card: oklch(0.155 0.008 155);
      --card-fg: oklch(0.92 0.01 155);
      --muted: oklch(0.20 0.01 155);
      --border: oklch(1 0 0 / 7%);
      --primary: oklch(0.65 0.10 158);
      --primary-fg: oklch(0.115 0.005 155);
      --tag-bg: oklch(0.19 0.02 155);
      --tag-fg: oklch(0.65 0.07 158);
    }

    /* === Base === */
    html { background: var(--bg); color: var(--fg-muted); }
    .dark html, html.dark { background: var(--bg); }
    ::selection { background: oklch(0.48 0.10 158 / 20%); }
    
    /* Scrollbar */
    ::-webkit-scrollbar { width: 5px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 3px; }

    /* === Utility classes === */
    .text-fg { color: var(--fg); }
    .text-fg-muted { color: var(--fg-muted); }
    .text-primary { color: var(--primary); }
    .bg-bg { background: var(--bg); }
    .bg-card { background: var(--card); }
    .bg-muted { background: var(--muted); }
    .border-theme { border-color: var(--border); }
    .bg-tag { background: var(--tag-bg); color: var(--tag-fg); }

    /* === Article content — dense, research-report style === */
    .article-content h2 { font-size: 1.1rem; font-weight: 600; margin-top: 2rem; margin-bottom: 0.75rem; color: var(--fg); padding-bottom: 0.4rem; border-bottom: 1px solid var(--border); }
    .article-content h3 { font-size: 0.95rem; font-weight: 600; margin-top: 1.5rem; margin-bottom: 0.5rem; color: var(--fg); }
    .article-content p { margin-bottom: 0.75rem; line-height: 1.7; font-size: 0.9rem; }
    .article-content ul { list-style: none; padding-left: 0; margin-bottom: 0.75rem; }
    .article-content li { margin-bottom: 0.4rem; line-height: 1.65; font-size: 0.9rem; padding-left: 1rem; position: relative; }
    .article-content li::before { content: "·"; position: absolute; left: 0; color: var(--primary); font-weight: bold; }
    .article-content a { color: var(--primary); text-decoration: none; border-bottom: 1px solid transparent; transition: border-color 0.15s; }
    .article-content a:hover { border-bottom-color: var(--primary); }
    .article-content strong { color: var(--fg); font-weight: 600; }
    .article-content hr { border: none; border-top: 1px solid var(--border); margin: 1.5rem 0; }
    .article-content blockquote { border-left: 2px solid var(--primary); padding: 0.5rem 1rem; color: var(--fg-muted); margin: 1rem 0; background: var(--muted); border-radius: 0 var(--radius) var(--radius) 0; font-size: 0.875rem; }
    .article-content code { font-family: 'JetBrains Mono', monospace; font-size: 0.8rem; background: var(--muted); padding: 0.1rem 0.35rem; border-radius: 3px; }
    .article-content pre { background: var(--card); border: 1px solid var(--border); border-radius: var(--radius); padding: 0.75rem; overflow-x: auto; margin: 1rem 0; font-size: 0.8rem; }
    .article-content pre code { background: none; padding: 0; }
    .article-content em { font-size: 0.85rem; }

    /* TOC sidebar styling */
    #TableOfContents { font-size: 0.75rem; }
    #TableOfContents ul { list-style: none; padding-left: 0; margin: 0; }
    #TableOfContents li { margin-bottom: 0.35rem; }
    #TableOfContents a { color: var(--fg-muted); text-decoration: none; transition: color 0.15s; display: block; padding: 0.15rem 0; }
    #TableOfContents a:hover { color: var(--primary); }
    #TableOfContents ul ul { padding-left: 0.75rem; margin-top: 0.25rem; }

    /* Line clamp utility */
    .line-clamp-2 { display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
    .line-clamp-3 { display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical; overflow: hidden; }

    /* === Card component === */
    .card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      transition: border-color 0.15s ease;
    }
    .card:hover { border-color: var(--fg-muted); }

    /* === Stat card === */
    .stat-value { font-size: 1.5rem; font-weight: 700; font-family: 'JetBrains Mono', monospace; color: var(--fg); }
    .stat-label { font-size: 0.75rem; color: var(--fg-muted); text-transform: uppercase; letter-spacing: 0.05em; }
    .stat-up { color: var(--stat-up); }
    .stat-down { color: var(--stat-down); }
  </style>

  {{ partial "extend_head.html" . }}
  
  {{/* RSS */}}
  {{ range .AlternativeOutputFormats }}
  <link rel="{{ .Rel }}" type="{{ .MediaType.Type }}" href="{{ .Permalink | safeURL }}">
  {{ end }}
</head>
<body class="bg-bg font-sans min-h-screen antialiased" style="color: var(--fg-muted)">
  
  {{ partial "header.html" . }}
  
  <main class="max-w-6xl mx-auto px-4 sm:px-6 py-6">
    {{ block "main" . }}{{ end }}
  </main>

  {{ partial "footer.html" . }}

  {{/* Theme toggle */}}
  <script>
    const html = document.documentElement;
    const stored = localStorage.getItem('theme');
    if (stored === 'light') html.classList.remove('dark');
    else if (stored === 'dark' || !stored) html.classList.add('dark');
    
    function toggleTheme() {
      html.classList.toggle('dark');
      localStorage.setItem('theme', html.classList.contains('dark') ? 'dark' : 'light');
    }
  </script>
</body>
</html>
